# Ангкор - coop игра

## Жанр игры
Онлайн платформер с элементами логической игры

## Сеттинг игры
#### Исторический жанр
Камбоджа, 1860 год. Французский путешественник Анри Муо открывает заброшенный город Ангкор, когда-то столицу процветающей империи. Разрушенные здания обросли корнями, листьями и лианами. Что же заставило миллионное население Ангкора покинуть город? 

#### Идея
Игрок, контролируя одного из персонажей, перемещается по локациям и разгадывает встречающиеся на пути загадки.
На своем пути персонажи встречают разные объекты:
- Объекты убивающие персонажа - шипы, болото
- Различные загадки: двери, рычаги, кнопки

## Технология игры

### Основные библиотеки
- pygame,
- pygame_gui
- os
- socket
- pickle
- Thread
- math

### Графика
Пиксельная графика, стилизованная под визуал консолей III㇐IV поколения.
Размеры:
- Персонаж - 32✕58
- Тайл - 50✕50
- Окно - 1000✕700
_(Вся графика расположена в папке image)_

### Запуск игры
При запуске игры игрока встречает приветственный экран на котором показано название игры и технология, на которой она разрабатывалась
После происходит переход на главное меню 
_(за всё это отвечает функция start_screen)_

### Реализация меню
В меню находятся кнопки:
- Начать новую игру. Перекидывает на сцену лобби и одновременно создаёт сейв для загрузки
- Найти лобби. Перекидывает на сцену, где написан код лобби для подключения другого игрока. Тут же есть кнопка старта, но только у хоста комнаты. Под игроками показывается управление
- Найти лобби. Перекидывает на сцену ввода кода для подключения к игре
- Продолжить. Перекидывает на сцену сейвов. Игрок может выбрать один из своих последних сейвов. После чего игрока перекидывает на сцену лобби
- Выйти. Выход из игры
- Настройки. Находиться в разработке

Главное меню игры анимированное. Фон полностью импортирован и состоит из самой игры

### Реализация уровней

В файле _level.py_ находиться класс Level, который и строит уровень. В него передаются все групп спрайтов и папку, откуда будут браться все некоторые текстуры, звуки и карты уровней. Благодаря тому, что каждой уровень находиться в своей папке, можно легко и быстро создавать новые. Необходимо лишь добавить все необходимо компоненты. Также вместе с этим классом находятся другие классы _Wind, LeavesMain_, которые помогают строить окружение уровня и добавляет атмосферы (листва, ветер)     

##### карты
В игре присевает эффект параллакса и объёма уровня. Для достижение этой цели было сделано несколько карт. Существует основной файл _map.txt_, который генерирует саму платформу с препятствиями и загадками. И также есть три других файла _layer_1 и др_, которые генерирует планы


### Реализация объекты
В игре присутствуют различные объекты, которые по разному влияют на геймплей игры
- Lever (Рычаг, с помощью которого можно открыть определённую дверь)
- Door (Дверь, которая привязывается к определённому рычагу)
- Button (Кнопка, с помощью которой можно открыть дверь. Для открытие, нужно стоять на кнопке)
- Spikes (Шипы, убивают игрока)
- Water, Swamp (Вода и болото. Вода как декоративный объект, болото убивает)
- Rope (Декоративный элемент)
- SavePoint (Точка сохранение. После её пересечения, игроки будут сравниться на этой точке)

Про самые интересные объекты я расскажу поподробнее

#### class Water

Да, можно было импортировать библиотеку, где уже красиво и оптимизировано сделана вода, но это было слишком просто, поэтому мы не ищем легких путей

Для создания волны, мы смоделируем поверхность воды в виде ряда пружин. Представьте прямую, на которой поставили много точек с маленькой ценой деления, после от этих точек провели прямые вниз. И вот каждая такая прямая, это наша пружина. Таким образом волна сможет качаться вверх и вниз. Затем заставим частицы воды притягиваться к соседним частицам, чтобы позволить волнам распространяться.

Для этого у нас будет два списка пружин (левые и правые), где будет храниться их разница в высоте между каждой пружиной

Но почему пружина? Пружины имеют определенную естественную длину. Если вы растянете или сожмете пружину, она попытается вернуться к этой естественной длине. Дальше предстояло обратиться к физике, но не будем углубляться и перейдём к итогу.

Запустив код, сразу смотрим на разницу высот между каждой пружиной и ее соседями, и каждая пружина притягивает к себе соседние пружины, изменяя их положение и скорость. Волна готова, осталось её запустить

Чтобы запустить движение волн, мы добавим простой метод, который даёт вес на одну из пружин

#### class Rope

В каком-то плане логика похоже с логикой воды. Только теперь вместо пружин у нас обычные палки, которые мы скрепляем друг с другом и говорим их позицию. Как только толкаем одну из палок, другие подтягиваются к ней

### Реализация Мультиплеер

Для связи игроков были реализованы файлы
- server (Сервер, с помощью которого происходит подключение)
- network (Сеть, где упаковываем и получаем данные с сервера)
- game_sever (Доп файл, в котором хранится информация о каждой сессии)

## Установка
Устанавливаем нужные библиотеки

```
pip install -r requirements.txt
```

После этого вы уже можете запустить главное меню игры, но поиграть не сможете. Для этого нам нужно вписать некоторые данные для сервера

Нам нужно узнать IPv4-адрес. Я расскажу способ для Windows. Для других систем загулите, это несложно.
[Статья про IP для mac](https://ru.wikihow.com/узнать-свой-IP–адрес-на-Мас)
- Открываем cmd любыми удобным для вас способом. (нажимаем _Win + R_ и в открывшемся окне пишем cmd)
- В командной строке пишем _ipconfig_
- В выдавшемся результате ищем строку с IPv4-адрес и копируем её
- Заходим в файл _server.py_ и вставляем наши данные в переменную server. Такие же действия проделываем с файлом _network.py_

Теперь остаётся последний шаг, сделать параллельную работу, чтобы запустить два одинаковых файла и поиграть. Я работаю в PyCharm, поэтому покажу как это делать на его примере. Возможно Вам это даже и не понадобиться на других IDE
- Открываем файл _menu.py_ в PyCharm
- Жмём правой кнопкой мыши и нажимаем на  'Modify Run Configuration'
- В открывшемся меню в верху ищем 'Allow parallel run' и ставим галочку напротив него

Всё, теперь мы можем поиграть. Два раза запускаем файл _menu.py_ и один раз _server.py_

_Если у вас не будет запускаться, проверьте правильность вашего IPv4_